{% extends 'base.html' %}

{% block title %}
    {{ _('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è') }}
{% endblock %}

{% block head %}
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
<style>
    .registration-container {
        width: calc(100% - 22px);
        max-width: 400px;
        margin: 50px auto;
        padding: 20px;
        border: 1px solid #dee2e6;
        border-radius: 5px;
    }
    .form-group {
        margin-bottom: 15px;
    }
    .error-message {
        color: #dc3545;
    }
    .invalid .error-message {
        display: block;
    }
    .btn-block {
        margin-top: 20px;
    }
    /* Additional styles for consistency */
    .form-control {
        font-size: 0.9rem;
        height: calc(2.25rem + 2px);
        padding: 0.375rem 0.75rem;
    }
    .form-check-label {
        margin-top: 0.5rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="registration-container">
    <h2 class="text-center">{{ _('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è') }}</h2>
    <form action="{{ url_for('register') }}" method="post" id="registrationForm" class="needs-validation" novalidate>
        <div class="form-group">
            <input type="text" class="form-control" name="username" placeholder="{{ _('–ù–∏–∫') }}" pattern="[A-Za-z0-9]+" title="{{ _('–ù–∏–∫ –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –ª–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã –∏ —Ü–∏—Ñ—Ä—ã') }}" required>
        </div>
        <div class="form-group">
            <input type="password" class="form-control" name="password" id="password" placeholder="{{ _('–ü–∞—Ä–æ–ª—å') }}" pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}" title="{{ _('–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É —Ü–∏—Ñ—Ä—É, –æ–¥–Ω—É –ø—Ä–æ–ø–∏—Å–Ω—É—é –∏ —Å—Ç—Ä–æ—á–Ω—É—é –±—É–∫–≤—ã, –∏ –±—ã—Ç—å –¥–ª–∏–Ω–æ–π –Ω–µ –º–µ–Ω–µ–µ 8 —Å–∏–º–≤–æ–ª–æ–≤') }}" required>
        </div>
        <div class="form-group">
            <input type="password" class="form-control" name="confirm_password" id="confirmPassword" placeholder="{{ _('–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å') }}" required>
        </div>
        <div class="form-group">
            <input type="text" class="form-control" name="name" placeholder="{{ _('–ò–º—è') }}" required>
        </div>
        <div class="form-group">
            <select class="form-control" name="native_language" id="nativeLanguage" required onchange="excludeLanguage()">
                <option value="" disabled selected>{{ _('–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–¥–Ω–æ–π —è–∑—ã–∫') }}</option>
                <option value="Deutsch">Deutsch üá©üá™</option>
                <option value="English">English üá¨üáß</option>
                <option value="–†—É—Å—Å–∫–∏–π">–†—É—Å—Å–∫–∏–π üá∑üá∫</option>
                <option value="Espa√±ol">Espa√±ol üá™üá∏</option>
            </select>
        </div>
        <div class="form-group">
            <select class="form-control" name="target_language" id="targetLanguage" required>
                <option value="" disabled selected>{{ _('–í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫ –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è') }}</option>
                <option value="Deutsch">Deutsch üá©üá™</option>
                <option value="English">English üá¨üáß</option>
                <option value="–†—É—Å—Å–∫–∏–π">–†—É—Å—Å–∫–∏–π üá∑üá∫</option>
                <option value="Espa√±ol">Espa√±ol üá™üá∏</option>
            </select>
        </div>
        <button type="submit" class="btn btn-primary btn-block">{{ _('–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è') }}</button>
    </form>
    <p id="passwordError" class="error-message" style="display: none;">{{ _('–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç.') }}</p>
    <p id="languageError" class="error-message" style="display: none;">{{ _('–†–æ–¥–Ω–æ–π –∏ –∏–∑—É—á–∞–µ–º—ã–π —è–∑—ã–∫–∏ –Ω–µ –º–æ–≥—É—Ç —Å–æ–≤–ø–∞–¥–∞—Ç—å.') }}</p>
    {% if username_exists %}
        <p class="error-message">{{ _('–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É–∂–µ –∑–∞–Ω—è—Ç–æ. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –¥—Ä—É–≥–æ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.') }}</p>
    {% endif %}
</div>
<script>
    const registrationForm = document.getElementById('registrationForm');
    const passwordInput = document.getElementById('password');
    const confirmPasswordInput = document.getElementById('confirmPassword');
    const passwordError = document.getElementById('passwordError');
    const nativeLanguageSelect = document.getElementById('nativeLanguage');
    const targetLanguageSelect = document.getElementById('targetLanguage');
    const languageError = document.getElementById('languageError');

    function validatePassword() {
        if (passwordInput.value !== confirmPasswordInput.value) {
            passwordError.style.display = 'block';
            registrationForm.classList.add('invalid');
        } else {
            passwordError.style.display = 'none';
            registrationForm.classList.remove('invalid');
        }
    }

    function checkLanguages() {
        if (nativeLanguageSelect.value === targetLanguageSelect.value) {
            languageError.style.display = 'block';
            registrationForm.classList.add('invalid');
        } else {
            languageError.style.display = 'none';
            registrationForm.classList.remove('invalid');
        }
    }

    passwordInput.addEventListener('change', validatePassword);
    confirmPasswordInput.addEventListener('keyup', validatePassword);
    nativeLanguageSelect.addEventListener('change', checkLanguages);
    targetLanguageSelect.addEventListener('change', checkLanguages);
</script>
{% endblock %}